! Configuração de infraestrutura da empresa Tecsol
! Este arquivo contém parâmetros essenciais para a configuração dos sistemas internos da empresa Tecsol.
! Data de criação: 2024-06-15
! Autor: Erick Fanka

! Criar Vlans em todos os switches
enable
configure terminal
vlan 10
    name Administracao
    exit
vlan 20
    name Suporte
    exit
vlan 30
    name Vendas
    exit
Vlan 50 
    name DMZ
    exit
vlan 99
    name Gerenciamento
    exit
vlan 999
    name NATIVE
    end
write memory
show vlan brief

! Configurar SW1
enable
configure terminal
hostname SW1
interface gigabitethernet0/1
    switchport mode trunk
    switchport trunk native vlan 999
    switchport trunk allowed vlan 10,20,30,50,99,999
    description Trunk_para_R1
    no shutdown
    exit
interface gigabitethernet1/1
    switchport mode trunk
    switchport trunk native vlan 999
    switchport trunk allowed vlan 10,20,30,50,99,999
    description Trunk_para_SW2
    no shutdown
    exit
interface gigabitethernet2/1
    switchport mode trunk
    switchport trunk native vlan 999
    switchport trunk allowed vlan 10,20,30,50,99,999
    description Trunk_para_SW3
    no shutdown
    exit
interface gigabitethernet3/1
    switchport mode access
    switchport access vlan 50
    description SRV1
    no shutdown
    exit
interface gigabitethernet9/1
    switchport mode access
    switchport access vlan 99
    description Gerenciamento
    no shutdown
    exit
interface vlan 99
    ip address 192.168.99.2 255.255.255.0
    no shutdown
    exit
ip default-gateway 192.168.99.1
end
write memory    
show running-config

! Configurar SW2
enable
configure terminal
hostname SW2
interface gigabitethernet0/1
    switchport mode trunk
    switchport trunk native vlan 999
    switchport trunk allowed vlan 10,20,30,50,99,999
    description Trunk_para_SW1
    no shutdown
    exit
interface gigabitethernet1/1
    switchport mode access
    switchport access vlan 10
    description PC1
    no shutdown
    exit
interface gigabitethernet2/1
    switchport mode access
    switchport access vlan 10
    description PC2
    no shutdown
    exit
interface gigabitethernet3/1
    switchport mode access
    switchport access vlan 10
    description PC2
    no shutdown
    exit
interface gigabitethernet4/1
    switchport mode access
    switchport access vlan 10
    description PC4
    no shutdown
    exit

interface gigabitethernet5/1
    switchport mode access
    switchport access vlan 20
    description PC5
    no shutdown
    exit
interface gigabitethernet6/1
    switchport mode access
    switchport access vlan 20
    description PC6
    no shutdown
    exit
interface gigabitethernet7/1
    switchport mode access
    switchport access vlan 20
    description PC7
    no shutdown
    exit  
interface vlan 99
    ip address 192.168.99.3 255.255.255.0
    no shutdown
    exit
ip default-gateway 192.168.99.1
end
write memory    
show running-config

! Configurar SW3
enable
configure terminal
hostname SW3
interface gigabitethernet0/1
    switchport mode trunk
    switchport trunk native vlan 999
    switchport trunk allowed vlan 10,20,30,50,99,999
    description Trunk_para_SW1
    no shutdown
    exit
interface gigabitethernet1/1
    switchport mode access
    switchport access vlan 30
    description PC8
    no shutdown
    exit
interface gigabitethernet2/1
    switchport mode access
    switchport access vlan 30
    description PC9
    no shutdown
    exit
interface gigabitethernet3/1
    switchport mode access
    switchport access vlan 30
    description PC10
    no shutdown
    exit
interface gigabitethernet4/1
    switchport mode access
    switchport access vlan 30
    description PC11
    no shutdown
    exit

interface gigabitethernet5/1
    switchport mode access
    switchport access vlan 30
    description PC12
    no shutdown
    exit
interface vlan 99
    ip address 192.168.99.4 255.255.255.0
    no shutdown
    exit
ip default-gateway 192.168.99.1
end
write memory    
show running-config

! Configurar R1
enable
configure terminal
hostname R1

! Ativar interface física
interface gigabitethernet0/0
 no shutdown
 exit

! Subinterfaces para VLANs
interface gigabitethernet0/0.10
 encapsulation dot1Q 10
 ip address 192.168.10.1 255.255.255.0
 description VLAN_10_Administracao
 exit

interface gigabitethernet0/0.20
 encapsulation dot1Q 20
 ip address 192.168.20.1 255.255.255.0
 description VLAN_20_Suporte
 exit

interface gigabitethernet0/0.30
 encapsulation dot1Q 30
 ip address 192.168.30.1 255.255.255.0
 description VLAN_30_Vendas
 ip access-group ACL_VENDAS in
 exit

interface gigabitethernet0/0.50
 encapsulation dot1Q 50
 ip address 192.168.50.1 255.255.255.0
 description VLAN_50_DMZ
 exit

interface gigabitethernet0/0.99
 encapsulation dot1Q 99
 ip address 192.168.99.1 255.255.255.0
 description VLAN_99_Gerenciamento
 exit

interface gigabitethernet0/0.999
 encapsulation dot1Q 999 native
 description VLAN_999_Native
 exit

! Reservar IPs de gateway
ip dhcp excluded-address 192.168.10.1
ip dhcp excluded-address 192.168.20.1
ip dhcp excluded-address 192.168.30.1
ip dhcp excluded-address 192.168.50.1
ip dhcp excluded-address 192.168.99.1

! Pools DHCP
ip dhcp pool VLAN-10
 network 192.168.10.0 255.255.255.0
 default-router 192.168.10.1
 dns-server 192.168.50.10
 exit

ip dhcp pool VLAN-20
 network 192.168.20.0 255.255.255.0
 default-router 192.168.20.1
 dns-server 192.168.50.10
 exit

ip dhcp pool VLAN-30
 network 192.168.30.0 255.255.255.0
 default-router 192.168.30.1
 dns-server 192.168.50.10
 exit

ip dhcp pool VLAN-99
 network 192.168.99.0 255.255.255.0
 default-router 192.168.99.1
 dns-server 192.168.50.10
 exit

! ACL para restringir VLAN 30
ip access-list extended ACL_VENDAS
 remark --- Permite DHCP ---
 permit udp 192.168.30.0 0.0.0.255 any eq bootpc
 permit udp any eq bootps 192.168.30.0 0.0.0.255

 remark --- Permite acesso ao servidor DMZ ---
 permit tcp 192.168.30.0 0.0.0.255 host 192.168.50.10 eq www
 permit tcp 192.168.30.0 0.0.0.255 host 192.168.50.10 eq 443
 permit udp 192.168.30.0 0.0.0.255 host 192.168.50.10 eq domain

 remark --- Bloqueia acesso às redes internas ---
 deny ip 192.168.30.0 0.0.0.255 192.168.10.0 0.0.0.255
 deny ip 192.168.30.0 0.0.0.255 192.168.20.0 0.0.0.255
 deny ip 192.168.30.0 0.0.0.255 192.168.99.0 0.0.0.255

 remark --- Permite todo o restante (internet) ---
 permit ip 192.168.30.0 0.0.0.255 any
 exit
write memory
show running-config